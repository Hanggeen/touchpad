<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="">
  <meta name="x5-orientation" content="portrait">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta content="telephone=no" name="format-detection">
  <meta content="email=no" name="format-detection">
  <meta itemprop="name" content="try"/>
  <meta name="description" itemprop="description" content="trackpad" />
  <meta name="keywords" content="trackpad">
  <title>try</title>
  <style>
  html,body {
    width:100%;
    height:100%;
  }
  </style>
</head>
<body style="height:100%;overflow:hidden;width:100%;height:100%;position:fixed;top:0;left:0;background-color:#fff">
  <div id="main" style="width:100%;height:100%;position:fixed;top:0;left:0;">
  </div>
<script>

// 打开一个WebSocket:
let ws = new WebSocket('ws://172.20.10.3:3000');

// 打开WebSocket连接后立刻发送一条消息:
ws.addEventListener('open', function () {
    ws.send(JSON.stringify({
      type: 'init-poster',
      data: 'first'
    }));
});

// 响应收到的消息:
ws.addEventListener('message', function (message) {
  console.log(`[CLIENT] Received: ${message}`);
})

var dom = document.getElementById('main');

var startX = 0, startY = 0;


dom.addEventListener('touchstart', function(e){
  startX = e.touches[0].pageX;
  startY = e.touches[0].pageY;
})

dom.addEventListener('touchmove', function(e){

  var X, Y;
  X = e.touches[0].pageX - startX;
  Y = e.touches[0].pageY - startY;

  startX = e.touches[0].pageX;
  startY = e.touches[0].pageY;

  slide(X, Y)

}, false);

dom.addEventListener('touchend', function(e){})

dom.addEventListener('click', function(e){
  click()
})

function slide(x, y) {
  ws.send(JSON.stringify({
    type: 'post',
    code: 'first',
    action: 'slide',
    data: {
      x: x,
      y: y
    }
  }))
}

function click() {
  ws.send(JSON.stringify({
    type: 'post',
    code: 'first',
    action: 'click',
    data: {}
  }))
}

  </script>
</body>
</html>